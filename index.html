<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR物流計測アシスト</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; }
        .ui-panel {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; background: rgba(255, 255, 255, 0.9);
            padding: 15px; border-radius: 15px; z-index: 1000; text-align: center;
        }
        .result-box { font-weight: bold; color: #007bff; font-size: 1.2rem; margin-top: 10px; }
        .guide-text { font-size: 0.8rem; color: #666; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; margin-top: 5px; }
    </style>
</head>
<body>

<div class="ui-panel">
    <div class="guide-text">カメラを物体に向け、サイズを調整してください</div>
    <div id="dimensions">幅: 30cm | 奥行: 30cm | 高さ: 30cm</div>
    <div id="best-box" class="result-box">判定待ち...</div>
    <button onclick="changeSize('w', 5)">幅+5</button>
    <button onclick="changeSize('w', -5)">幅-5</button>
    <br>
    <button onclick="calculateBox()">このサイズで確定</button>
</div>

<a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
    <a-box id="guideBox" position="0 0 -1" material="color: #007bff; opacity: 0.3; wireframe: false;" scale="0.3 0.3 0.3">
        <a-text value="MEASURE" position="-0.5 0.6 0" color="black" width="3"></a-text>
    </a-box>
    <a-entity camera></a-entity>
</a-scene>

<script>
    let currentW = 30, currentD = 30, currentH = 30;

    const boxList = [
        { name: "サイズ100", w: 45, d: 35, h: 20 },
        { name: "サイズ120", w: 55, d: 40, h: 25 },
        { name: "サイズ140", w: 65, d: 50, h: 25 },
        { name: "サイズ160", w: 75, d: 55, h: 30 }
    ];

    function changeSize(type, val) {
        if(type === 'w') currentW += val;
        updateDisplay();
    }

    function updateDisplay() {
        document.getElementById('dimensions').innerText = `幅: ${currentW}cm | 奥行: ${currentD}cm | 高さ: ${currentH}cm`;
        // 3Dモデルの大きさを変更
        const box = document.getElementById('guideBox');
        box.setAttribute('scale', `${currentW/100} ${currentH/100} ${currentD/100}`);
    }

    function calculateBox() {
        const buffer = 3;
        const req = [currentW + buffer, currentD + buffer, currentH + buffer].sort((a, b) => a - b);
        let foundBox = null;

        for (let box of boxList) {
            const bSides = [box.w, box.d, box.h].sort((a, b) => a - b);
            if (req[0] <= bSides[0] && req[1] <= bSides[1] && req[2] <= bSides[2]) {
                foundBox = box;
                break;
            }
        }

        const resultDiv = document.getElementById('best-box');
        resultDiv.innerText = foundBox ? `推奨：${foundBox.name}` : "適合なし";
    }
</script>

</body>
</html>
